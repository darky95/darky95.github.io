<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kanban Board 3</title>
<style>
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background-color: #f8f9fa;
        margin: 0;
        padding: 20px;
    }

    .board-container {
        display: flex;
        justify-content: center;
        align-items: flex-start;
        height: 100vh;
    }

    .board {
        display: flex;
        flex-grow: 1;
    }

    .column {
        flex-grow: 1;
        border: 1px solid #dee2e6;
        border-radius: 5px;
        margin: 10px;
        padding: 20px;
        min-width: 300px;
        background-color: #fff;
        box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }

    .column h2 {
        font-size: 1.2rem;
        margin-bottom: 10px;
    }

    .tasks {
        min-height: 200px;
    }

    .task {
        background-color: #f1f3f5;
        border: 1px solid #ced4da;
        border-radius: 5px;
        padding: 10px;
        margin: 5px 0;
        cursor: pointer;
        display: flex;
        justify-content: space-between;
        align-items: center;
        position: relative;
    }

    .task-timestamp {
        font-size: 0.8rem;
        color: #6c757d;
        position: absolute;
        bottom: 5px;
        right: 5px;
    }

    input[type="text"] {
        width: 100%;
        padding: 8px;
        margin-bottom: 10px;
        border: 1px solid #ced4da;
        border-radius: 5px;
        font-size: 1rem;
    }

    button {
        background-color: #007bff;
        color: #fff;
        border: none;
        border-radius: 5px;
        padding: 10px 20px;
        cursor: pointer;
    }

    button:hover {
        background-color: #0056b3;
    }
</style>
</head>
<body>
<div class="input-container">
    <input type="text" id="task-input" placeholder="Enter a new task">
    <button onclick="addTask()">Add Task</button>
</div>

<div class="board-container">
    <div class="board">
        <div id="todo" class="column" ondrop="drop(event, 'todo')" ondragover="allowDrop(event)">
            <h2>Todo</h2>
            <div id="todo-tasks" class="tasks"></div>
        </div>
        <div id="in-progress" class="column" ondrop="drop(event, 'in-progress')" ondragover="allowDrop(event)">
            <h2>In Progress</h2>
            <div id="in-progress-tasks" class="tasks"></div>
        </div>
        <div id="done" class="column" ondrop="drop(event, 'done')" ondragover="allowDrop(event)">
            <h2>Done</h2>
            <div id="done-tasks" class="tasks"></div>
        </div>
    </div>
</div>

<script>
    const DB_NAME = "kanbanDB";
    const DB_VERSION = 1;
    let db;

    function initDB() {
        const request = indexedDB.open(DB_NAME, DB_VERSION);

        request.onerror = function(event) {
            console.error("Database error: " + event.target.errorCode);
        };

        request.onupgradeneeded = function(event) {
            db = event.target.result;
            const objectStore = db.createObjectStore("tasks", { keyPath: "id", autoIncrement: true });
            objectStore.createIndex("title", "title", { unique: false });
            objectStore.createIndex("column", "column", { unique: false });
            objectStore.createIndex("timestamp", "timestamp", { unique: false });
        };

        request.onsuccess = function(event) {
            db = event.target.result;
            loadTasks();
        };
    }

    function addTask() {
        const input = document.getElementById('task-input');
        const title = input.value.trim();
        if (title === "") return;

        const transaction = db.transaction("tasks", "readwrite");
        const objectStore = transaction.objectStore("tasks");
        const task = { title, column: "todo", timestamp: Date.now() };
        
        const request = objectStore.add(task);
        
        request.onsuccess = function(event) {
            loadTasks();
            input.value = "";
        };

        request.onerror = function(event) {
            console.error("Error adding task");
        };
    }

    function loadTasks() {
        const transaction = db.transaction("tasks", "readonly");
        const objectStore = transaction.objectStore("tasks");
        const todoTasks = document.getElementById('todo-tasks');
        const inProgressTasks = document.getElementById('in-progress-tasks');
        const doneTasks = document.getElementById('done-tasks');

        todoTasks.innerHTML = "";
        inProgressTasks.innerHTML = "";
        doneTasks.innerHTML = "";

        objectStore.openCursor().onsuccess = function(event) {
            const cursor = event.target.result;
            if (cursor) {
                const task = cursor.value;
                const taskElement = createTaskElement(task);
                if (task.column === "todo") {
                    todoTasks.appendChild(taskElement);
                } else if (task.column === "in-progress") {
                    inProgressTasks.appendChild(taskElement);
                } else if (task.column === "done") {
                    doneTasks.appendChild(taskElement);
                }
                cursor.continue();
            }
        };
    }

    function createTaskElement(task) {
        const taskElement = document.createElement('div');
        taskElement.classList.add('task');
        taskElement.draggable = true;
        taskElement.setAttribute('data-id', task.id);
        taskElement.setAttribute('ondragstart', 'drag(event)');
        taskElement.innerHTML = `
            <span>${task.title}</span>
            <span class="task-timestamp">${new Date(task.timestamp).toLocaleString()}</span>
            <button onclick="deleteTask(${task.id})">Delete</button>
        `;
        return taskElement;
    }

    function allowDrop(ev) {
        ev.preventDefault();
    }

    function drag(ev) {
        ev.dataTransfer.setData("text", ev.target.getAttribute('data-id'));
    }

    function drop(ev, column) {
        ev.preventDefault();
        const data = ev.dataTransfer.getData("text");
        const taskId = parseInt(data);
        const taskElement = document.querySelector(`[data-id='${taskId}']`);
        const sourceColumnId = taskElement.parentElement.id;
        
        if (sourceColumnId !== column) {
            moveTask(taskId, column);
            ev.target.appendChild(taskElement);
        }
    }

    function moveTask(taskId, column) {
        const transaction = db.transaction("tasks", "readwrite");
        const objectStore = transaction.objectStore("tasks");
        const request = objectStore.get(taskId);

        request.onsuccess = function(event) {
            const task = event.target.result;
            task.column = column;
            const updateRequest = objectStore.put(task);
            updateRequest.onerror = function(event) {
                console.error("Error updating task");
            };
            loadTasks();
        };

        request.onerror = function(event) {
            console.error("Error getting task");
        };
    }

    function deleteTask(taskId) {
        const transaction = db.transaction("tasks", "readwrite");
        const objectStore = transaction.objectStore("tasks");
        const request = objectStore.delete(taskId);

        request.onsuccess = function(event) {
            loadTasks();
        };

        request.onerror = function(event) {
            console.error("Error deleting task");
        };
    }

    document.addEventListener("DOMContentLoaded", function() {
        initDB();
    });
</script>
</body>
</html>
